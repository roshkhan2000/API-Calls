# import libraries
import pandas as pd
import requests

# The API endpoint URL
api = "https://api.notion.com/v1/databases/*insert database ID*/query"

# Define headers 
headers = {
    "Authorization": "Bearer ntn_*insert API Key*", 
    "Content-Type": "application/json",
    "Notion-Version": "2022-06-28"
}

# Make the API request
api_call = requests.post(api, headers=headers)

# Get the data as JSON
json = api_call.json()

# The line below is commented out and is to find keys to see which column can be flattened
    # print(json.keys())

# Convert the entire results to a flattened dataframe
    # pd.json_normalize automatically flattens nested structures
    # specifically, it flattens the column/key 'results' to different columns
flattened = pd.json_normalize(json['results'])

# Save locally
flattened.to_csv(r"Downloads\notion_api.csv")
